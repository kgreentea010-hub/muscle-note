<!DOCTYPE html>
<html lang="ja">
<head>
  <meta charset="UTF-8" />
  <title>ç­‹ãƒˆãƒ¬ãƒãƒ¼ãƒˆ</title>
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <style>
    body {
      font-family: -apple-system, BlinkMacSystemFont, sans-serif;
      background: #f5f5f5;
      margin: 0;
      padding: 16px;
    }
    h1 {
      text-align: center;
    }
    .card {
      background: #fff;
      padding: 12px;
      margin-bottom: 12px;
      border-radius: 8px;
    }
    input, button {
      width: 100%;
      padding: 10px;
      margin-top: 6px;
      font-size: 16px;
    }
    button {
      background: #007aff;
      color: white;
      border: none;
      border-radius: 6px;
    }
    .record {
      margin-top: 6px;
    }
    input[type="checkbox"] {
     width: auto;
     padding: 0;
     margin: 0;
}
  </style>
</head>
<body>

<h1>ç­‹ãƒˆãƒ¬ãƒãƒ¼ãƒˆ</h1>

<div class="card">
  <input id="date" type="date">
  <input id="menu" placeholder="ç¨®ç›®ï¼ˆä¾‹ï¼šãƒ™ãƒ³ãƒãƒ—ãƒ¬ã‚¹ï¼‰">
  <input id="weight" placeholder="é‡é‡ï¼ˆkgï¼‰" type="number">
  <input id="reps" placeholder="å›æ•°" type="number">
  <button onclick="addRecord()">è¨˜éŒ²ã™ã‚‹</button>
  
  <label style="display:flex; align-items:center; gap:8px; margin-top:8px;">
   <input type="checkbox" id="autoRest">
  è¨˜éŒ²å¾Œã«è‡ªå‹•ã§ãƒ¬ã‚¹ãƒˆã‚¿ã‚¤ãƒãƒ¼é–‹å§‹
</label>
  
</div>
<div class="card">
  <h2>ãƒ¬ã‚¹ãƒˆã‚¿ã‚¤ãƒãƒ¼</h2>

  <input
    type="range"
    id="timerRange"
    min="10"
    max="300"
    step="10"
    value="60"
  >

  <div id="timerLabel">60 ç§’</div>

  <button id="startTimer">ã‚¹ã‚¿ãƒ¼ãƒˆ</button>
  <button id="stopTimer">åœæ­¢</button>
</div>

<div class="card">
  <h2>è¨˜éŒ²ä¸€è¦§</h2>
  <div id="records"></div>
</div>
<div class="card">
ã€€<h2>ç¨®ç›®åˆ¥å±¥æ­´</h2>
  <select id="filterMenu">
    <option value="">ç¨®ç›®ã‚’é¸æŠ</option>
  </select>
  <div id="filteredRecords"></div>

  <h3>MAXé‡é‡</h3>
  <div id="maxRecords"></div>
  <button onclick="exportCSV()">CSVæ›¸ãå‡ºã—</button>
</div>

<script>
  const filterMenuEl = document.getElementById("filterMenu");
  const filteredRecordsEl = document.getElementById("filteredRecords");
  const recordsEl = document.getElementById("records");
  const dateEl = document.getElementById("date");
  const menuEl = document.getElementById("menu");
  const weightEl = document.getElementById("weight");
  const repsEl = document.getElementById("reps");
  const maxRecordsEl = document.getElementById("maxRecords");
  const timerRange = document.getElementById("timerRange");
  const timerLabel = document.getElementById("timerLabel");
  const startBtn = document.getElementById("startTimer");
  const stopBtn = document.getElementById("stopTimer");

  let timerId = null;
  let remaining = 0;

  startBtn.addEventListener("click", () => {
  if (timerId) return; // äºŒé‡èµ·å‹•é˜²æ­¢

  remaining = Number(timerRange.value);
  timerLabel.textContent = `${remaining} ç§’`;

  timerId = setInterval(() => {
   remaining--;
   timerLabel.textContent = `${remaining} ç§’`;

  if (remaining <= 0) {
    clearInterval(timerId);
    timerId = null;

    timerLabel.textContent = "ä¼‘æ†©çµ‚äº†ï¼";
    timerLabel.style.color = "red";
    timerLabel.style.fontSize = "28px";
    timerLabel.style.fontWeight = "bold";
    
    playBeep();

    if (navigator.vibrate) {
      navigator.vibrate([200, 100, 200]);
    }

    // alertã¯ä½¿ã‚ãªã„ï¼
  }
}, 1000);
    
});

  stopBtn.addEventListener("click", () => {
  clearInterval(timerId);
  timerId = null;
  timerLabel.textContent = "åœæ­¢ã—ã¾ã—ãŸ";
});

timerRange.addEventListener("input", () => {
  timerLabel.textContent = `${timerRange.value} ç§’`;
});
  
  function setToday() {
  const today = new Date().toISOString().slice(0, 10);
  dateEl.value = today;
}
  let records = JSON.parse(localStorage.getItem("records")) || [];

  function addRecord() {
  if (!menuEl.value || !weightEl.value || !repsEl.value) return;

  records.push({
    date: dateEl.value || new Date().toISOString().slice(0, 10),
    menu: menuEl.value,
    weight: Number(weightEl.value),
    reps: Number(repsEl.value)
  });

  menuEl.value = "";
  weightEl.value = "";
  repsEl.value = "";
  setToday();

  render();
}
 function updateMenuOptions() {
  const menus = [...new Set(records.map(r => r.menu))];

  filterMenuEl.innerHTML = '<option value="">ç¨®ç›®ã‚’é¸æŠ</option>';

  menus.forEach(menu => {
    const option = document.createElement("option");
    option.value = menu;
    option.textContent = menu;
    filterMenuEl.appendChild(option);
  });
}
  function deleteRecord(record) {
    records = records.filter(r =>
      !(r.date === record.date &&
        r.menu === record.menu &&
        r.weight === record.weight &&
        r.reps === record.reps)
    );
    render();
  }

  function render() {
    const today = new Date().toISOString().slice(0, 10);

    records.forEach(r => {
      if (!r.date) {
       r.date = today;
    }
  });

  recordsEl.innerHTML = "";

  const grouped = {};

  records.forEach(r => {
   if (!grouped[r.date]) {
   grouped[r.date] = {};
   }
   if (!grouped[r.date][r.menu]) {
    grouped[r.date][r.menu] = [];
   }
   grouped[r.date][r.menu].push(r);
});

    Object.keys(grouped)
  .sort()
  .reverse()
  .forEach(date => {
    const title = document.createElement("h3");

    if (date === today) {
    title.textContent = `ğŸ”¥ ä»Šæ—¥ (${date})`;
    title.style.color = "#d32f2f";
    title.style.background = "#ffecec";
    title.style.padding = "6px";
    title.style.borderRadius = "6px";
  } else {
    title.textContent = date;
  }

recordsEl.appendChild(title);

    const menus = grouped[date];

    Object.keys(menus).forEach(menu => {
      const menuTitle = document.createElement("strong");
      menuTitle.textContent = `â–¼ ${menu}`;
      recordsEl.appendChild(menuTitle);

      menus[menu].forEach(r => {
        const div = document.createElement("div");
        div.className = "record";
        div.textContent = `ã€€${r.weight}kg Ã— ${r.reps}å›`;
        recordsEl.appendChild(div);
      });
    });
  });

    localStorage.setItem("records", JSON.stringify(records));
    updateMenuOptions();
    renderMax();
  }
  
function renderMax() {
  maxRecordsEl.innerHTML = "";

  const maxMap = {};

  records.forEach(r => {
    // ãƒ‡ãƒ¼ã‚¿ãŒå£Šã‚Œã¦ã‚‹å ´åˆã¯ç„¡è¦–
    if (!r.menu || r.weight == null) return;

    const w = Number(r.weight);
    if (!maxMap[r.menu] || w > maxMap[r.menu]) {
      maxMap[r.menu] = w;
    }
  });

  Object.keys(maxMap).forEach(menu => {
    const div = document.createElement("div");
    div.textContent = `${menu}ï¼šMAX ${maxMap[menu]}kg`;
    maxRecordsEl.appendChild(div);
  });
}
function exportCSV() {
  if (records.length === 0) {
    alert("è¨˜éŒ²ãŒã‚ã‚Šã¾ã›ã‚“");
    return;
  }

  const header = ["æ—¥ä»˜", "ç¨®ç›®", "é‡é‡(kg)", "å›æ•°"];
  const rows = records.map(r => [
    r.date,
    r.menu,
    r.weight,
    r.reps
  ]);

  const csv = [header, ...rows]
    .map(row => row.join(","))
    .join("\n");

  const blob = new Blob([csv], { type: "text/csv;charset=utf-8;" });
  const url = URL.createObjectURL(blob);

  const a = document.createElement("a");
  a.href = url;
  a.download = "workout_records.csv";
  a.click();

  URL.revokeObjectURL(url);
}
filterMenuEl.addEventListener("change", () => {
  const selected = filterMenuEl.value;
  filteredRecordsEl.innerHTML = "";

  if (!selected) return;

  records
    .filter(r => r.menu === selected)
    .forEach(r => {
      const div = document.createElement("div");
      div.className = "record";
      div.textContent = `${r.date}ï½œ${r.weight}kg Ã— ${r.reps}å›`;
      filteredRecordsEl.appendChild(div);
    });
});
  setToday();
  render();
function playBeep() {
  const audio = new Audio(
    "data:audio/wav;base64,UklGRiQAAABXQVZFZm10IBAAAAABAAEAQB8AAEAfAAABAAgAZGF0YQAAAAA="
  );
  audio.play();
}
</script>
</body>
</html>
